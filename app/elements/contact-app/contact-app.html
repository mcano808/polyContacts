<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../scheduled-call/scheduled-call.html">
<link rel="import" href="../contacts-list/contacts-list.html">
<link rel="import" href="../contact-card/contact-card.html">
<link rel="import" href="../new-contact/new-contact.html">
<link rel="import" href="../auto-scroller/auto-scroller.html">
<link rel="import" href="../../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/yoso-searchfield/yoso-searchfield.html">

<polymer-element name="contact-app">
  <template>
    <style>
      :host {
        display: block;
      }
      .back{
        position: absolute!important;
        left:-40px;
        z-index: 10;
      }
      .current-action{
        position: absolute!important;
        bottom:-10px;
        right:-20px;
        z-index:10;

      }
      :host /deep/ core-toolbar{
        background-color:#388E3C;
        font-size: .95em;
      }

      .contact_list_title{
        font-size: .80em;
      }
      .logo{
        height:40px;
        width:40px;
        color:#cddc39;
      }
      .page-title{
        font-size: 1.5em;
      }

    </style>
    <core-scaffold>
      <!-- Left Side Drawer-->
      <nav>
        <core-toolbar layout horizonal>
          <yoso-searchfield hint="Find me..." text="{{searchValue}}" flex></yoso-searchfield>
        </core-toolbar>
        <div layout horizontal>
        <contacts-list flex id="contactList" selContact="{{selectedContact}}"></contacts-list>
        <auto-scroller></auto-scroller>
        </div>
      </nav>

      <!-- Right side and main content -->
      <core-toolbar tool flex>
        <div layout horizontal flex>
          <template if="{{selectedPage !== 'scheduledCalls'}}">
            <core-icon icon="arrow-back"  on-tap="{{backToScheduledCalls}}"></core-icon>
          </template>
          <span class="page-title" flex>{{pageTitle}}</span>
        </div>
        <!-- Which button displayed depends on selected page. -->
        <template if="{{selectedPage === 'scheduledCalls'}}">
          <paper-fab icon="account-circle" class="current-action accent-color" on-tap="{{newContact}}"></paper-fab>
        </template>
        <template if="{{selectedPage === 'newContact'}}">
          <paper-fab class="current-action accent-color" icon="add-circle-outline" on-tap="{{addNewContact}}"></paper-fab>
        </template>

      </core-toolbar>

      <!-- Main page Content here -->
      <core-animated-pages valueattr="id" selected="{{selectedPage}}" transitions="slide-from-right" layout vertical fit>
        <scheduled-call id="scheduledCalls" selContact="{{selectedContact}}"></scheduled-call>
        <contact-card id= "contactCard" contact="{{selectedContact}}"></contact-card>
        <new-contact id="newContact" contact="{{newContactRecord}}"></new-contact>
      </core-animated-pages>
    </core-scaffold>
  </template>
  <script>
    (function () {
      Polymer({
        backToScheduledCalls:function (e){
          this.changePage('scheduledCalls', 'Today...');
        },
        /**
         * Private method used to set a new page and page title.
         * newPage param must match ID of page you want to go to.
         * @param {String} newPage The id of the page to change to.
         * @param {String} title The string to be used as the title for the new Page.
         */
        changePage: function(newPage, title){
          this.selectedPage = newPage;
          this.pageTitle = title;
        },
        // define element prototype here
        contacts:[],
        gotData: function(evt, detail){
          this.contacts = detail.response.contacts;
        },
        //Handler to go to the new contact page.
        newContact:function(e, detail, target){
          this.changePage('newContact', 'New Contact')
        },
        addNewContact:function(){
          console.log('adding the new contact', this.newContactRecord);
          //Add the new contact to the list.  TODO- this will be a service call later.
          this.contacts.push(this.newContactRecord);
          //Call the clear method to clear the fields.
          this.$.newContact.reset();

          //Change the page to scheduledCalls
          this.changePage('scheduledCalls', 'Today...');
        },

        //Stores the currently selected contact
        selectedContact:{},
        //Stores the currently selected page.  This is wired
        selectedPage:'scheduledCalls',
        pageTitle: 'Today...',
        selectedContactChanged: function(ov, nv){
          var title = this.selectedContact.name.last + ', ' + this.selectedContact.name.first;
          this.changePage('contactCard',title)
        }

      });
    })();
  </script>
</polymer-element>
